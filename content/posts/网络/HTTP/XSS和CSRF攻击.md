---
title: XSS和CSRF攻击
date: 2021-06-01
categories: [网络/HTTP]
tags: [网络安全,HTTP]
---

## XSS攻击

`Cross Site Script` 跨站脚本攻击，为了不和`CSS`混淆，所以缩写为`XSS`

在网页的输入框中最容易被XSS攻击，比如在一个评论框中，用户输入了以下内容

```html
<script>alert(“hello,XSS”)</script>
```

那么网页在渲染这段数据的时候就相当于嵌入了一段`js`脚本代码，以后所有用户访问此网站都会被执行这段代码

上面注入的只是简单的弹窗代码，但是如果注入的是一些恶意的js脚本，那么每个用户访问都会在后台默默的执行注入的恶意js代码

恶意的js代码可以做啥呢

- 窃取用户的`Cookie`，如果`Set-Cookie`没有设置`HttpOnly`的话则可以被js代码读取并且通过网络转发给黑客，那么用户的Cookie数据就泄露了
- 伪造用户，通过js脚本使用用户的Cookie来请求网站，以此假冒用户登入 (利用浏览器的同源策略可以避免)
- 劫持流量实现恶意跳转，每当用户访问时js代码执行强行跳转劫持用户到另外的站点

预防XSS

- 过滤用户的输入

- 将用户的输入内容插入特殊符号进行转义

​    

## CSRF攻击

`Cross Site Request Forgery` 跨站请求伪造攻击

攻击者诱导受害者进入第三方网站，在第三方网站中，向被攻击网站发送跨站请求

利用受害者在被攻击网站已经获取的注册凭证`Cookie`，绕过后台的用户验证，达到冒充用户对被攻击的网站执行某项操作的目的

下面是一个案例

- 小明登入了银行网站A，网站A设置Cookie来作为用户之后请求的Token
- 小明在登入银行A之后被诱导点击了网站B
- 网站B向A发送了一个转账请求，浏览器会携带上之前网站A设置的Cookie
- A收到请求之后就会验证通过，此时小明的钱就被网站B转走了

网站B在受害者不知情的情况下冒充受害者，通过Cookie让网站A执行了网站B定义的操作

由于浏览器有同源策略，因此网站B向网站A发送请求会被浏览器认定为跨域，因此会被浏览器拦截

但是有下面几种情况不会被拦截:

- 所有拥有`src`属性的 `<script>、<img>、<iframe>` 以及`<a>`标签等，是不会经过同源策略，因为浏览器认为这些标签肯定是网站主动引用外部资源所加入的的所以不需要规定同源策略，例如`baidu.com`引用了CDN的`jquery`

- 浏览器为了方便表单的提交，所以 `<form>` 中填的`action` 也不会限制同源策略，可以填写任意的URL，一旦用户提交表单那么就会请求URL发生跨域。如果用户在恶意网站里面填写并提交了表单则可能会被CSRF攻击

如何防止CSRF攻击？

- 服务端验证请求，比如验证HTTP请求头的`Referer`字段
- 浏览器同源策略，防止跨域请求
- 加入token，比如我们可以在请求参数后面附加一个token，每次请求都验证一下这个token，因为黑客并不知道这个token，则可以防止CSRF攻击

​    

## 参考

[如何防止XSS攻击？](https://tech.meituan.com/2018/09/27/fe-security.html)

[如何防止CSRF攻击？](https://tech.meituan.com/2018/10/11/fe-security-csrf.html)

[安全篇——如何预防CSRF攻击](https://segmentfault.com/a/1190000023153554)

[Cookie 的 SameSite 属性](https://www.ruanyifeng.com/blog/2019/09/cookie-samesite.html)