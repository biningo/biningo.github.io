---
title: HTTP2和HTTP3
date: 2021-03-16
categories: [网络]
tags: [HTTP]
draft: true
---

## HTTP2(不懂)

### 1、头部压缩

原来的`HTTP/1.1`的头部都会很大，有时候甚至会超过数据的大小，所以HTTP2将头部进行了压缩，采用 `HPACK`压缩算法

压缩原理大致就是使用一份索引表来定义常用的头部字段和属性，然后传输的时候只需要指定这些索引即可

并且为了方统一管理，HTTP2还将第一行也转化为Header的kv形式，叫做**伪头部** 这些头部都是以 `:`开头，为了区别于其它头部

| 伪头部     | 含义     |
| ---------- | -------- |
| :authority | 域名     |
| :method    | 请求方法 |
| :status    | 状态码   |

HTTP将一些最常用的头部，并且值都是固定不变的头部信息建立了一个静态表，静态表如下:

![](https://raw.githubusercontent.com/biningo/cdn/master/img1/http2.png)

为一些可变的头部建立动态表，动态添加

### 2、二进制帧格式传输数据

二进制格式传输，将原来的 `Header+Body` 拆分为一个个的二进制数据帧，`HEADERS帧`存放头数据、`DATA帧`存放实体数据，这些数据帧都有一些控制信息用于拼接为完整的HTTP报文，还有其他类型的数据帧比如一些控制信息的数据帧

另外HTTP里面有流的概念，每个数据帧都有一个`StreamID`来标识属于哪个流，然后一个TCP连接可以传输多个流的数据帧，但是流里面的数据帧必须要有序的，方便服务器拼接这些数据帧为完整的HTTP报文

一个流中的数据帧不一定需要在一个TCP，也可以并发的在多个TCP连接里面传递，最后服务器只需要搜集所有TCP连接中流的所有数据帧然后拼接为一个HTTP报文即可，这就是HTTP2的 **TCP多路复用**

流传递数据是全双工的，也就是说HTTP2中服务器可以推送数据给客户端

### 3、多路复用

HTTP报文因为被拆分为了多个帧，这些帧，那么这些帧就可以在任意一条TCP通道里面进行传输了，同一个TCP连接可以传输不同请求的数据帧，每个请求的数据帧都属于同一个流，会有相同的流ID，服务器和客户端就是通过流ID来区分不同的请求和应答的

### 4、服务器推送

服务器可以主动和客户端建立流通道，然后服务器就可以向客户端推送数据了

​    

## HTTP3(科普)

由于HTTP2是基于TCP协议的，TCP协议有很多缺点，其中TCP也有 **队头阻塞**  问题，窗口前面的数据包没到的话窗口就不能继续滑动，就必须等待前面的数据包到了之后才可以进行后面的传送

所有HTTP3放弃了TCP协议作为传输层协议，而采用`QUIC`协议，该协议是基于`UDP`协议的，目的是为了取代TCP协议

​    

## 参考

https://halfrost.com/http2-frequently-asked-questions

https://halfrost.com/http2-http-frames/

https://juejin.cn/post/6844903774339727374

https://github.com/zqjflash/http2-protocol