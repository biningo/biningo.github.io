---
title: SSL-TSL-HTTPS和CA证书
date: 2021-01-14
categories: [网络安全]
tags: [SSL\TLS,HTTPS,网络]
---

## 对称加密

**对称加密**就是在两端通信的时候使用**同一个密钥**进行加密解密

特点：

- 不够安全，密钥如何传的问题（由非对称加密解决）
- 加解密的CPU消耗低

相关算法：`DES、AES`

​    

​    

## 非对称加密

**非对称加密**就是使用不同的密钥进行加密解密，比如使用 **公钥** 加密，使用 **私钥 **解密

特点：

- 安全，解决了 **对称加密** 密钥传输问题
- 加解密CPU消耗高，需要复杂的数学运算

> **所以一般使用非对称加密进行传输对称加密密钥，之后用对称加密进行通信**

相关算法：`RSA、ECC`

​    

​    

## 信息摘要

**摘要**主要是为了 **防止信息被篡改** ，又称为 **信息指纹** 

字符串、文件等内容经过 **摘要算法(hash算法)** 进行hash散列之后得到的一串固定长度的 **hash字符串** 这就是 **信息摘要** 

常见的hash算法有：`MD5、SHA256`

​    

​    

## 数字签名

**数字签名**是一个非对称加密的方式，**私钥签名，公钥解密**

- A：用自己的**A私钥**对 **摘要** 进行加密，加密后的就叫 **数字签名** 这样摘要在传输过程中就不会被篡改
- B：用 **A公钥** 对 **数字签名** 进行解密，得到**摘要** ，然后再用相同的 **信息摘要算法**对消息体计算摘要，对比两个摘要是否相同就可以验证消息体是否被篡改

​    

​    

## CA证书

### CA证书

**CA证书**类似于身份证，用来**证明公钥的正确性**，证明对方发来的公钥是否属于对方，就比如公安局给公民发放身份证来证明这个人就是你

想象一下如果不验证公钥的正确性的话：

- A给B发送自己的公钥时被中间人
- C劫持并替换为C的公钥发给B
- B以为是A的公钥，则继续用C的公钥通信，
- 那么C就可以劫持所有B给A发送的消息

为了验证发来的公钥是否被劫持，是否属于对方，那么就需要一个**第三方权威机构**颁发一个**CA证书**来证明身份

​    

### CA证书组成

1. 颁发者(证书的发布机构)
2. 有效期从, 到 (证书的有效期)
3. **证书持有者的公钥**
4. 证书持有者信息
5. 摘要算法（对证书生成 **摘要**的算法 ）
6. **证书本身的摘要** （防止证书被篡改）
7. 签名算法（对证书摘要签名的算法）
8. **证书的CA签名**

​    

### 证书签名和验证过程

1. CA生成证书
    - 对证书颁发者信息、证书持有者信息、证书有效期、**证书持有者公钥**等信息并生成**证书摘要**，将摘要附着在证书上
    - CA用自己的私钥对 **证书摘要** 进行签名，并将 **证书签名**附着在证书上，这时这个证书就是进过CA签名过的合法证书，相对于给证书盖个章吧
    - CA将签过名的证书发给证书拥有者
2. 发送者A发送自己的证书
    - A要给B发消息要先发送自己的证书，证明这个是自己
    - 这时就不会遭受**中间人攻击**了，因为中间人没有CA的私钥，无法伪造签名

3. 接受者验证证书并且获得A的公钥
    - B通过某种途径（如浏览器访问）拿到签过名的数字证书
    - B使用CA公钥解密 **签名**，得到 **证书摘要**，然后对证书用相同 **摘要算法** 计算摘要，对比两个摘要是否相同，相同则证明证书信息没有被篡改，然后从证书中获取**A的公钥**

​    

### CA证书信任链

那么如何保证CA的公钥是属于CA自己的呢？这就涉及到证书调用链的过程

小一点的 CA 可以让大 CA 签名认证，但链条的最后，也就是**Root CA**，就只能自己证明自己了，这个就叫“**自签名证书**”（Self-Signed Certificate）或者“**根证书**”（Root Certificate）

<img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/81c813f84a264ca1addceb470cbd77bf~tplv-k3u1fbpfcp-watermark.image" style="zoom:50%;" />

​    

​    

## SSL/TLS协议和HTTPS

![img](https://user-gold-cdn.xitu.io/2019/9/9/16d1385e7286a6a4?imageView2/0/w/1280/h/960/format/webp/ignore-error/1)

`HTTP`通讯只需要建立`TCP`连接即可

`HTTPS`通讯之前双方在建立`TCP`连接之后还需要建立`SSL/TLS`连接，在`SSL/TLS`之上进行通讯的`HTTP`协议就叫`HTTPS` ，所以 `HTTPS=HTTP+SSL/TLS`

**SSL/TLS建立连接交换密钥的过程：**

![在这里插入图片描述](https://user-gold-cdn.xitu.io/2020/4/29/171c19d411a7eacb?imageView2/0/w/1280/h/960/format/webp/ignore-error/1)

​    

1. 客户端给出 
    - `SSL/TSL`协议的版本号
    - 随机数 `R1`
    - 客户端支持的非对称加密算法`RSA、ECC`等
2. 服务器端返回
    - 使用的加密算法
    - 数字证书
    - 随机数`R2`
3. 客户端认证证书有效性，是否被篡改等，如果证书有效则：
    - 生成随机数 `R3`
    - 用证书中的公钥（也就是服务器的公钥）加密`R3` 并发送回去
4. 服务器用自己的私钥解密 `R3`，此时双方持有 `R1、R2、R3` 3个随机数，其中 `R3`是经过非对称加密的，不可能被外界获取
5. 然后双方就使用相同的方法结合3个随机数生成 **对称加密密钥** ，这就完成了对称加密密钥的传输，之后就可以使用对称加密进行传输数据了

​    

​    

## 参考

http://www.ruanyifeng.com/blog/2011/08/what_is_a_digital_signature.html

https://juejin.cn/post/6844903638117122056#heading-21

https://www.bilibili.com/video/BV1KV41187ko?p=3

https://juejin.cn/post/6844903937938554888

https://juejin.cn/post/6844904148719124488#heading-1