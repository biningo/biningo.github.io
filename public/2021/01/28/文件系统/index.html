<!doctype html><html lang=zh-cn><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><meta http-equiv=x-ua-compatible content="IE=edge, chrome=1"><title>文件系统 - lyer's blog</title><meta name=Description content><meta property="og:title" content="文件系统"><meta property="og:description" content="​
​
VFS虚拟文件系统 虚拟文件系统就是给文件系统的实现提供一个接口，好处有下面几个：
 为用户进程提供一组操作文件/目录/其他对象的统一方法，方便操作 为下层文件系统的具体实现提供统一的接口，让操作系统能适配多个文件系统  在每个分区上必须安装文件系统，这样操作系统才可以操作磁盘和文件，不然操作系统是无法使用磁盘的，在分区上安装文件系统其实就是增加一些文件系统对磁盘的管理数据，同时将分区划分为一个个数据块，安装文件系统的过程就叫 分区格式化 格式化之后分区的主要结构如下：
​
​
1、super block 超级块 super block在索引导块后面，主要包含整个文件系统的一些基本元数据：
 文件系统中的数据块数 文件系统设置的数据块大小（一个数据块通常占据整数个扇区比如：8个扇区 4k大小） 空闲块数 空闲的inode节点数 &mldr;&mldr;.  ​
​
2、inode节点区块 是一个数组结构，每个文件都有一个inode，linux用inode号来标识不同的文件，而不是通过文件名
stat a.html #查看文件的inode信息 ls -i a.html #查看文件的inode ID df -i #查看各个分区的inode总数和使用量 -hi inode 节点主要包括了以下信息：
  文件的inode ID
  模式/权限（保护）
  所有者 ID、组 ID
  文件大小（字节数）、文件类型
  文件的硬链接数
  上次访问时间、最后修改时间、inode 上次修改时间
  文件的数据块block映射表（0-n逻辑数据块号分别映射到实际的数据块号）所以同一个文件的数据可以不连续的存放在不同的数据块中 单个inode结构图如下："><meta property="og:type" content="article"><meta property="og:url" content="/2021/01/28/%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F/"><meta property="article:published_time" content="2021-01-28T00:00:00+00:00"><meta property="article:modified_time" content="2021-01-28T00:00:00+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="文件系统"><meta name=twitter:description content="​
​
VFS虚拟文件系统 虚拟文件系统就是给文件系统的实现提供一个接口，好处有下面几个：
 为用户进程提供一组操作文件/目录/其他对象的统一方法，方便操作 为下层文件系统的具体实现提供统一的接口，让操作系统能适配多个文件系统  在每个分区上必须安装文件系统，这样操作系统才可以操作磁盘和文件，不然操作系统是无法使用磁盘的，在分区上安装文件系统其实就是增加一些文件系统对磁盘的管理数据，同时将分区划分为一个个数据块，安装文件系统的过程就叫 分区格式化 格式化之后分区的主要结构如下：
​
​
1、super block 超级块 super block在索引导块后面，主要包含整个文件系统的一些基本元数据：
 文件系统中的数据块数 文件系统设置的数据块大小（一个数据块通常占据整数个扇区比如：8个扇区 4k大小） 空闲块数 空闲的inode节点数 &mldr;&mldr;.  ​
​
2、inode节点区块 是一个数组结构，每个文件都有一个inode，linux用inode号来标识不同的文件，而不是通过文件名
stat a.html #查看文件的inode信息 ls -i a.html #查看文件的inode ID df -i #查看各个分区的inode总数和使用量 -hi inode 节点主要包括了以下信息：
  文件的inode ID
  模式/权限（保护）
  所有者 ID、组 ID
  文件大小（字节数）、文件类型
  文件的硬链接数
  上次访问时间、最后修改时间、inode 上次修改时间
  文件的数据块block映射表（0-n逻辑数据块号分别映射到实际的数据块号）所以同一个文件的数据可以不连续的存放在不同的数据块中 单个inode结构图如下："><meta name=application-name content="lyer's blog"><meta name=apple-mobile-web-app-title content="lyer's blog"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=manifest href=/site.webmanifest><link rel=canonical href=/2021/01/28/%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F/><link rel=prev href=/2021/01/23/%E7%A3%81%E7%9B%98%E5%92%8C%E5%88%86%E5%8C%BA/><link rel=stylesheet href=/lib/normalize/normalize.min.css><link rel=stylesheet href=/css/style.min.css><link rel=stylesheet href=/lib/fontawesome-free/all.min.css><link rel=stylesheet href=/lib/animate/animate.min.css><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"文件系统","inLanguage":"zh-CN","mainEntityOfPage":{"@type":"WebPage","@id":"\/2021\/01\/28\/%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F\/"},"genre":"posts","keywords":"Linux, OS","wordcount":367,"url":"\/2021\/01\/28\/%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F\/","datePublished":"2021-01-28T00:00:00+00:00","dateModified":"2021-01-28T00:00:00+00:00","publisher":{"@type":"Organization","name":"lyer"},"author":{"@type":"Person","name":"lyer"},"description":""}</script></head><body header-desktop header-mobile><script type=text/javascript>(window.localStorage&&localStorage.getItem('theme')?localStorage.getItem('theme')==='dark':(''==='auto'?window.matchMedia('(prefers-color-scheme: dark)').matches:''==='dark'))&&document.body.setAttribute('theme','dark');</script><div id=mask></div><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper><div class=header-title><a href=/ title="lyer's blog">lyer's blog</a></div><div class=menu><div class=menu-inner><a class=menu-item href=/posts/>归档 </a><a class=menu-item href=/tags/>标签 </a><a class=menu-item href=/categories/>分类 </a><a class=menu-item href=/about>关于 </a><span class="menu-item delimiter"></span><a href=javascript:void(0); class="menu-item theme-switch" title=切换主题><i class="fas fa-adjust fa-fw"></i></a></div></div></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title="lyer's blog">lyer's blog</a></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><div class=menu id=menu-mobile><a class=menu-item href=/posts/>归档</a><a class=menu-item href=/tags/>标签</a><a class=menu-item href=/categories/>分类</a><a class=menu-item href=/about>关于</a><a href=javascript:void(0); class="menu-item theme-switch" title=切换主题>
<i class="fas fa-adjust fa-fw"></i></a></div></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><main class=main><div class=container><div class=toc id=toc-auto><h2 class=toc-title>目录</h2><div class=toc-content id=toc-content-auto></div></div><article class="page single"><h1 class="single-title animated flipInX">文件系统</h1><div class=post-meta><div class=post-meta-line><span class=post-author><a href=https://icepan.cloud title=Author target=_blank rel="noopener noreffer author" class=author><i class="fas fa-user-circle fa-fw"></i>lyer</a></span>&nbsp;<span class=post-category>收录于 <a href=/categories/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/><i class="far fa-folder fa-fw"></i>操作系统</a></span></div><div class=post-meta-line><i class="far fa-calendar-alt fa-fw"></i>&nbsp;<time datetime=2021-01-28>2021-01-28</time>&nbsp;<i class="fas fa-pencil-alt fa-fw"></i>&nbsp;约 367 字&nbsp;
<i class="far fa-clock fa-fw"></i>&nbsp;预计阅读 2 分钟&nbsp;</div></div><div class="details toc" id=toc-static kept><div class="details-summary toc-title"><span>目录</span>
<span><i class="details-icon fas fa-angle-right"></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><a href=#vfs虚拟文件系统>VFS虚拟文件系统</a><ul><li><a href=#1super-block-超级块>1、super block 超级块</a></li><li><a href=#2inode节点区块>2、inode节点区块</a></li><li><a href=#3空闲块位图和inode位图>3、空闲块位图和inode位图</a></li></ul></li><li><a href=#vfs四大对象>VFS四大对象</a><ul><li><a href=#1super-block超级块>1、super block超级块</a></li><li><a href=#2innode>2、innode</a></li><li><a href=#3dentry>3、dentry</a></li><li><a href=#4file>4、file</a></li></ul></li><li><a href=#缓存>缓存</a></li><li><a href=#参考>参考</a></li></ul></nav></div></div><div class=content id=content><p>​</p><p>​</p><h2 id=vfs虚拟文件系统>VFS虚拟文件系统</h2><p>虚拟文件系统就是给文件系统的实现提供一个接口，好处有下面几个：</p><ul><li><strong>为用户进程提供一组操作文件/目录/其他对象的统一方法，方便操作</strong></li><li><strong>为下层文件系统的具体实现提供统一的接口，让操作系统能适配多个文件系统</strong></li></ul><p><img class=lazyload src=/svg/loading.min.svg data-src=https://raw.githubusercontent.com/biningo/cdn/master/img/KVrP0Yk.png data-srcset="https://raw.githubusercontent.com/biningo/cdn/master/img/KVrP0Yk.png, https://raw.githubusercontent.com/biningo/cdn/master/img/KVrP0Yk.png 1.5x, https://raw.githubusercontent.com/biningo/cdn/master/img/KVrP0Yk.png 2x" data-sizes=auto alt=https://raw.githubusercontent.com/biningo/cdn/master/img/KVrP0Yk.png title=image-20181020173556821></p><p>在每个分区上必须安装文件系统，这样操作系统才可以操作磁盘和文件，不然操作系统是无法使用磁盘的，在分区上安装文件系统其实就是增加一些文件系统对磁盘的管理数据，同时将分区划分为一个个数据块，安装文件系统的过程就叫 <strong>分区格式化</strong> 格式化之后分区的主要结构如下：</p><p><img class=lazyload src=/svg/loading.min.svg data-src=https://mianbaoban-assets.oss-cn-shenzhen.aliyuncs.com/2021/1/JV73ii.png data-srcset="https://mianbaoban-assets.oss-cn-shenzhen.aliyuncs.com/2021/1/JV73ii.png, https://mianbaoban-assets.oss-cn-shenzhen.aliyuncs.com/2021/1/JV73ii.png 1.5x, https://mianbaoban-assets.oss-cn-shenzhen.aliyuncs.com/2021/1/JV73ii.png 2x" data-sizes=auto alt=https://mianbaoban-assets.oss-cn-shenzhen.aliyuncs.com/2021/1/JV73ii.png title=img></p><p>​</p><p>​</p><h3 id=1super-block-超级块>1、super block 超级块</h3><p><code>super block</code>在索引导块后面，主要包含整个文件系统的一些基本元数据：</p><ul><li>文件系统中的数据块数</li><li>文件系统设置的数据块大小（一个数据块通常占据整数个扇区比如：<code>8个扇区</code> <code>4k</code>大小）</li><li>空闲块数</li><li>空闲的inode节点数</li><li>&mldr;&mldr;.</li></ul><p>​</p><p>​</p><h3 id=2inode节点区块>2、inode节点区块</h3><p>是一个数组结构，每个文件都有一个<code>inode</code>，linux用inode号来标识不同的文件，而不是通过文件名</p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash>stat a.html <span class=c1>#查看文件的inode信息</span>
ls -i a.html <span class=c1>#查看文件的inode ID</span>
df -i <span class=c1>#查看各个分区的inode总数和使用量 -hi</span>
</code></pre></div><p><strong>inode 节点主要包括了以下信息：</strong></p><ul><li><p>文件的inode ID</p></li><li><p>模式/权限（保护）</p></li><li><p>所有者 ID、组 ID</p></li><li><p>文件大小（字节数）、文件类型</p></li><li><p>文件的硬链接数</p></li><li><p>上次访问时间、最后修改时间、inode 上次修改时间</p></li><li><p>文件的数据块block映射表（0-n逻辑数据块号分别映射到实际的数据块号）<strong>所以同一个文件的数据可以不连续的存放在不同的数据块中</strong> 单个inode结构图如下：</p><p></p></li></ul><p><strong>打开文件的过程如下：</strong></p><ul><li>找到文件名对应的<code>inode ID</code></li><li>通过<code>inode ID</code>获取该文件<code>inode</code>节点信息</li><li>根据文件的<code>inode</code>信息获取数据块block然后就可以读取磁盘数据了</li></ul><p><strong>目录其实也是一种文件：</strong></p><p>目录文件包含一系列的 <strong>目录项</strong> ，每个目录项由 <strong>文件名、文件对应的inode ID</strong>组成。目录也有自己的<code>inode</code></p><p>目录文件的读权限（r）和写权限（w），都是针对目录文件本身。由于目录文件内只有文件名和inode号码，所以如果只有读权限，只能获取文件名，无法获取其他信息，因为其他信息都储存在inode节点中，而读取inode节点内的信息需要目录文件的执行权限（x）</p><p><strong>硬链接：</strong></p><p>一般情况一个<code>inode</code>对应一个文件名，但是也可以多个文件名同时指向一个<code>inode</code>，对文件的修改都会生效，这就是 <strong>硬链接</strong></p><p>删除文其中一个文件名则不会删除文件，直到删除最后一个硬链接，也就是硬连接数变为0才会真正删除文件</p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash>ln 源文件 目标文件 <span class=c1>#创建硬链接</span>
</code></pre></div><p><strong>软链接：</strong></p><p>软链与硬链接最大的不同就是：软连接指向原文件的<strong>路径+文件名</strong>，依赖于原文件，原文件删除之后软链接也无效了</p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash>ln -s 源文文件或目录 目标文件或目录
</code></pre></div><p>​</p><p>​</p><h3 id=3空闲块位图和inode位图>3、空闲块位图和inode位图</h3><p><strong>空闲区块位图</strong> 管理整个分区中空闲的数据块</p><p><strong>inode位图</strong> 管理整个分区中<code>inode</code>的使用和分配</p><p>​</p><p>​</p><h2 id=vfs四大对象>VFS四大对象</h2><ul><li>super block</li><li>inode</li><li>dentry</li><li>file</li></ul><h3 id=1super-block超级块>1、super block超级块</h3><p>保存文件系统的所有元数据</p><ul><li>块大小</li><li>inode/block的总量、使用量、剩余量</li><li>指向空间 inode 和数据块的指针等相关信息</li></ul><p>通常是常驻内存的，<code>super_block</code>表示该对象,相关操作由结构体<code>super_operations</code>表示,定义在<code>linux/fs.h</code></p><div class=highlight><pre class=chroma><code class=language-c data-lang=c><span class=k>struct</span> <span class=n>super_block</span> <span class=p>{</span>
    <span class=k>struct</span> <span class=n>list_head</span>      <span class=n>s_list</span><span class=p>;</span>          <span class=c1>// 指向所有超级块的链表 
</span><span class=c1></span>    <span class=k>const</span> <span class=k>struct</span> <span class=n>super_operations</span>  <span class=o>*</span><span class=n>s_op</span><span class=p>;</span>  <span class=c1>// 超级块方法
</span><span class=c1></span>    <span class=k>struct</span> <span class=n>dentry</span>         <span class=o>*</span><span class=n>s_root</span><span class=p>;</span>         <span class=c1>// 目录挂载点 
</span><span class=c1></span>    <span class=k>struct</span> <span class=n>mutex</span>          <span class=n>s_lock</span><span class=p>;</span>    	   <span class=c1>// 超级块信号量
</span><span class=c1></span>    <span class=kt>int</span>                   <span class=n>s_count</span><span class=p>;</span>         <span class=c1>// 超级块引用计数
</span><span class=c1></span>    
	<span class=p>......</span>
        
    <span class=k>struct</span> <span class=n>list_head</span>      <span class=n>s_inodes</span><span class=p>;</span>        <span class=c1>// inode链表
</span><span class=c1></span>    <span class=k>struct</span> <span class=n>mtd_info</span>       <span class=o>*</span><span class=n>s_mtd</span><span class=p>;</span>          <span class=c1>// 存储磁盘信息
</span><span class=c1></span>    <span class=n>fmode_t</span>               <span class=n>s_mode</span><span class=p>;</span>          <span class=c1>// 安装权限
</span><span class=c1></span><span class=p>};</span>
</code></pre></div><p>​</p><h3 id=2innode>2、innode</h3><p>索引节点，唯一标识一个文件，保存文件相关信息，看上文</p><div class=highlight><pre class=chroma><code class=language-c data-lang=c><span class=k>struct</span> <span class=n>inode</span> <span class=p>{</span>
    <span class=k>struct</span> <span class=n>hlist_node</span> <span class=n>i_hash</span><span class=p>;</span>          			<span class=c1>// 散列表，用于快速查找inode
</span><span class=c1></span>    <span class=k>struct</span> <span class=n>list_head</span>  <span class=n>i_list</span><span class=p>;</span>    				<span class=c1>// 索引节点链表 
</span><span class=c1></span>    <span class=k>struct</span> <span class=n>list_head</span>  <span class=n>i_sb_list</span><span class=p>;</span> 				<span class=c1>// 超级块链表超级块 
</span><span class=c1></span>    <span class=k>struct</span> <span class=n>list_head</span>  <span class=n>i_dentry</span><span class=p>;</span>  				<span class=c1>// 目录项链表 
</span><span class=c1></span>	
    <span class=p>......</span>

    <span class=n>uid_t</span>             <span class=n>i_uid</span><span class=p>;</span>     				<span class=c1>// 使用者id 
</span><span class=c1></span>    <span class=n>gid_t</span>              <span class=n>i_gid</span><span class=p>;</span>     				<span class=c1>// 使用组id 
</span><span class=c1></span>    <span class=k>struct</span> <span class=n>timespec</span>   <span class=n>i_atime</span><span class=p>;</span>   				<span class=c1>// 最后访问时间 
</span><span class=c1></span>    <span class=k>struct</span> <span class=n>timespec</span>   <span class=n>i_mtime</span><span class=p>;</span>   				<span class=c1>// 最后修改时间 
</span><span class=c1></span>    <span class=k>struct</span> <span class=n>timespec</span>   <span class=n>i_ctime</span><span class=p>;</span>    				<span class=c1>// 最后改变时间 
</span><span class=c1></span>
    <span class=k>const</span> <span class=k>struct</span> <span class=n>inode_operations</span>  <span class=o>*</span><span class=n>i_op</span><span class=p>;</span>       <span class=c1>// 索引节点操作函数 
</span><span class=c1></span>    <span class=k>const</span> <span class=k>struct</span> <span class=n>file_operations</span>   <span class=o>*</span><span class=n>i_fop</span><span class=p>;</span>      <span class=c1>// 缺省的索引节点操作 
</span><span class=c1></span>    <span class=k>struct</span> <span class=n>super_block</span>            <span class=o>*</span><span class=n>i_sb</span><span class=p>;</span>        <span class=c1>// 相关的超级块 
</span><span class=c1></span>    <span class=k>struct</span> <span class=n>address_space</span>          <span class=o>*</span><span class=n>i_mapping</span><span class=p>;</span>   <span class=c1>// 相关的地址映射 
</span><span class=c1></span>    <span class=k>struct</span> <span class=n>address_space</span>          <span class=n>i_data</span><span class=p>;</span>       <span class=c1>// 设备地址映射 
</span><span class=c1></span>    <span class=kt>unsigned</span> <span class=kt>int</span>                  <span class=n>i_flags</span><span class=p>;</span>      <span class=c1>// 文件系统标志 
</span><span class=c1></span>    <span class=kt>void</span>                          <span class=o>*</span><span class=n>i_private</span><span class=p>;</span>   <span class=c1>// fs 私有指针 
</span><span class=c1></span><span class=p>};</span>
</code></pre></div><p>​</p><h3 id=3dentry>3、dentry</h3><ul><li><p>在文件路径中，每个部分都是<strong>目录项对象</strong>.比如<code>/bin/cp</code>中的<code>/</code>,<code>bin</code>,<code>cp</code>都属于目录项对象</p></li><li><p>文件系统的目录树结构就是通过一个个下目录项对象构建的</p></li><li><p>目录项对象不需要在磁盘中存储，没有对应的磁盘数据结构，VFS根据字符串形式的路径名现场创建它，并且保存在内存中</p></li></ul><div class=highlight><pre class=chroma><code class=language-c data-lang=c><span class=k>struct</span> <span class=n>dentry</span> <span class=p>{</span>
    <span class=n>atomic_t</span>      <span class=n>d_count</span><span class=p>;</span>         						<span class=c1>// 使用计数 
</span><span class=c1></span>    <span class=kt>unsigned</span> <span class=kt>int</span>  <span class=n>d_flags</span><span class=p>;</span>         						<span class=c1>// 目录项标识 
</span><span class=c1></span>    <span class=n>spinlock_t</span>    <span class=n>d_lock</span><span class=p>;</span>          						<span class=c1>// 单目录项锁 
</span><span class=c1></span>    <span class=k>struct</span> <span class=n>inode</span>  <span class=o>*</span><span class=n>d_inode</span><span class=p>;</span>        						<span class=c1>// 相关联的索引节点 
</span><span class=c1></span>    <span class=k>struct</span> <span class=n>hlist_node</span>  <span class=n>d_hash</span><span class=p>;</span>     						<span class=c1>// 散列表 
</span><span class=c1></span>    <span class=k>struct</span> <span class=n>dentry</span>      <span class=o>*</span><span class=n>d_parent</span><span class=p>;</span>  						<span class=c1>// 父目录的目录项对象 
</span><span class=c1></span>    <span class=k>struct</span> <span class=n>qstr</span>        <span class=n>d_name</span><span class=p>;</span>     						<span class=c1>// 目录项名称 
</span><span class=c1></span>    <span class=k>struct</span> <span class=n>list_head</span>   <span class=n>d_lru</span><span class=p>;</span>      						<span class=c1>// 未使用的链表
</span><span class=c1></span>
    <span class=k>struct</span> <span class=n>list_head</span>   <span class=n>d_subdirs</span><span class=p>;</span>  						<span class=c1>// 子目录链表 
</span><span class=c1></span>    <span class=k>struct</span> <span class=n>list_head</span>   <span class=n>d_alias</span><span class=p>;</span>    						<span class=c1>// 索引节点别名链表
</span><span class=c1></span>    <span class=kt>unsigned</span> <span class=kt>long</span>       <span class=n>d_time</span><span class=p>;</span>    						<span class=c1>// 重置时间 
</span><span class=c1></span>    <span class=k>const</span> <span class=k>struct</span> <span class=n>dentry_operations</span> <span class=o>*</span><span class=n>d_op</span><span class=p>;</span> 				<span class=c1>// 目录项操作相关函数 
</span><span class=c1></span>    
    <span class=p>......</span>
<span class=p>};</span>
</code></pre></div><p>​</p><h3 id=4file>4、file</h3><ul><li><p><strong>文件对象</strong>表示进程已经打开的文件</p></li><li><p>是已打开的文件在内存中的表示</p></li><li><p>由相应的<code>open()</code>系统调用创建</p></li><li><p>由<code>close()</code>系统调用撤销</p></li><li><p>多个进程可以同时打开和操作同一个文件，同一个文件也可能存在多个对应的文件对象，由于是同一个文件，其索引节点对象是唯一的,这样就实现了共享同一个磁盘文件</p></li></ul><p>在内核中,该对象由<code>file</code>结构体表示,其操作由结构体<code>file_operator</code>表示,定义在<code>linux/fs.h</code>中.</p><div class=highlight><pre class=chroma><code class=language-c data-lang=c><span class=k>struct</span> <span class=n>file</span> <span class=p>{</span>
    <span class=k>union</span> <span class=p>{</span>
        <span class=k>struct</span> <span class=n>llist_node</span>  <span class=n>fu_llist</span><span class=p>;</span>      <span class=c1>// 文件对象链表
</span><span class=c1></span>        <span class=k>struct</span> <span class=n>rcu_head</span>    <span class=n>fu_rcuhead</span><span class=p>;</span>    <span class=c1>// 释放之后的RCU链表
</span><span class=c1></span>    <span class=p>}</span> <span class=n>f_u</span><span class=p>;</span>
    <span class=k>struct</span> <span class=n>path</span>            <span class=n>f_path</span><span class=p>;</span>        <span class=c1>// 包含的目录项
</span><span class=c1></span>    <span class=k>struct</span> <span class=n>inode</span>           <span class=o>*</span><span class=n>f_inode</span><span class=p>;</span>      <span class=c1>// 缓存值
</span><span class=c1></span>    <span class=k>const</span> <span class=k>struct</span> <span class=n>file_operations</span>  <span class=o>*</span><span class=n>f_op</span><span class=p>;</span>  <span class=c1>// 文件操作函数
</span><span class=c1></span>    <span class=n>spinlock_t</span>		<span class=n>f_lock</span><span class=p>;</span>               <span class=c1>// 锁
</span><span class=c1></span>
    <span class=n>atomic_long_t</span>          <span class=n>f_count</span><span class=p>;</span>       <span class=c1>// 文件对象引用计数
</span><span class=c1></span>    
    <span class=p>......</span>
        
    <span class=k>struct</span> <span class=n>address_space</span>   <span class=o>*</span><span class=n>f_mapping</span><span class=p>;</span>
<span class=p>};</span>
</code></pre></div><p>​</p><p>​</p><h2 id=缓存>缓存</h2><p><img class=lazyload src=/svg/loading.min.svg data-src=https://raw.githubusercontent.com/biningo/cdn/master/img/1557481253963880.png data-srcset="https://raw.githubusercontent.com/biningo/cdn/master/img/1557481253963880.png, https://raw.githubusercontent.com/biningo/cdn/master/img/1557481253963880.png 1.5x, https://raw.githubusercontent.com/biningo/cdn/master/img/1557481253963880.png 2x" data-sizes=auto alt=https://raw.githubusercontent.com/biningo/cdn/master/img/1557481253963880.png title=https://raw.githubusercontent.com/biningo/cdn/master/img/1557481253963880.png></p><p>TODO</p><p>​</p><h2 id=参考>参考</h2><p><a href=https://www.eet-china.com/mp/a38145.html>https://www.eet-china.com/mp/a38145.html</a></p><p><a href=https://www.ruanyifeng.com/blog/2011/12/inode.html>https://www.ruanyifeng.com/blog/2011/12/inode.html</a></p><p><a href=http://lionoggo.com/2015/12/05/%e4%bb%8eVFS%e7%9c%8b%e6%96%87%e4%bb%b6%e8%af%bb%e5%86%99/#%e8%b6%85%e7%ba%a7%e5%9d%97%e5%af%b9%e8%b1%a1 target=_blank rel="noopener noreffer">http://lionoggo.com</a></p></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span>更新于 2021-01-28</span></div><div class=post-info-license></div></div><div class=post-info-line><div class=post-info-md></div><div class=post-info-share><span></span></div></div></div><div class=post-info-more><section class=post-tags><i class="fas fa-tags fa-fw"></i>&nbsp;<a href=/tags/linux/>Linux</a>,&nbsp;<a href=/tags/os/>OS</a></section><section><span><a href=javascript:void(0); onclick=window.history.back();>返回</a></span>&nbsp;|&nbsp;<span><a href=/>主页</a></span></section></div><div class=post-nav><a href=/2021/01/23/%E7%A3%81%E7%9B%98%E5%92%8C%E5%88%86%E5%8C%BA/ class=prev rel=prev title=磁盘和分区><i class="fas fa-angle-left fa-fw"></i>磁盘和分区</a></div></div><div id=comments><div id=gitalk class=comment></div><noscript>Please enable JavaScript to view the comments powered by <a href=https://github.com/gitalk/gitalk></a>Gitalk</a>.</noscript></div></article></div></main><footer class=footer><div class=footer-container><div class=footer-line>由 <a href=https://gohugo.io/ target=_blank rel="noopener noreffer" title="Hugo 0.80.0">Hugo</a> 强力驱动 | 主题 - <a href=https://github.com/dillonzq/LoveIt target=_blank rel="noopener noreffer" title="LoveIt 0.2.10"><i class="far fa-kiss-wink-heart fa-fw"></i>LoveIt</a></div><div class=footer-line><i class="far fa-copyright fa-fw"></i><span itemprop=copyrightYear>2021</span><span class=author itemprop=copyrightHolder>&nbsp;<a href=https://icepan.cloud target=_blank>lyer</a></span>&nbsp;|&nbsp;<span class=license><a rel="license external nofollow noopener noreffer" href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></span></div></div></footer></div><div id=fixed-buttons><a href=# id=back-to-top class=fixed-button title=回到顶部><i class="fas fa-arrow-up fa-fw"></i></a><a href=# id=view-comments class=fixed-button title=查看评论><i class="fas fa-comment fa-fw"></i></a></div><link rel=stylesheet href=/lib/gitalk/gitalk.min.css><script type=text/javascript src=/lib/gitalk/gitalk.min.js></script><script type=text/javascript src=/lib/smooth-scroll/smooth-scroll.min.js></script><script type=text/javascript src=/lib/lazysizes/lazysizes.min.js></script><script type=text/javascript src=/lib/clipboard/clipboard.min.js></script><script type=text/javascript>window.config={"code":{"copyTitle":"复制到剪贴板","maxShownLines":10},"comment":{"gitalk":{"admin":["biningo"],"clientID":"c8f473d59880800a7453","clientSecret":"7aa3dd0bcf966dee0a057e06eaf205caeb86b8e0","id":"2021-01-28T00:00:00Z","owner":"biningo","repo":"hugo-blog-gittalk","title":"文件系统"}}};</script><script type=text/javascript src=/js/theme.min.js></script></body></html>