<!DOCTYPE html>
<html lang="zh-CN">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="robots" content="noodp" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1">
        <title>磁盘和分区 - lyer&#39;s blog</title><meta name="Description" content=""><meta property="og:title" content="磁盘和分区" />
<meta property="og:description" content="​
磁盘物理结构   盘面：一个机械磁盘有好几个盘面组成，中间有转轴
  磁头：盘面正反两面都可以使用，每个盘面都有一个磁头，用来读写这个盘面的数据
  磁道：盘面被物理划分为多个磁道
  扇区：每个磁道会被划分为多个固定512byte大小的扇区（现在也有4k扇区），扇区是磁盘数据存储的最小单位。整个磁盘0盘面0磁道第一个1扇区最重要，记录了整个磁盘的分区信息和操作系统启动程序，计算机启动之后首先加载第一个扇区的信息到内存
  柱面：每个盘面的同一个磁道组成柱面，磁盘的读写顺序就是按照柱面来的，写入时按顺序先写满一个柱面（一个盘面的磁道数据写满后再激活下一个盘面的磁头）然后再移动磁头臂写另外一个柱面，读数据也是按照这个顺序读
  磁盘在出厂前需要进行低级格式化：就是给磁盘划分磁道、扇区。这些属于硬件层面，OS无法控制
​
​
磁盘寻址方式 早期所有磁道的扇区个数一样，采用CHS方式寻址，这种划分方式外磁道颗粒稀疏，存储密度小，造成空间浪费
现在的磁盘外磁道的扇区个数大于内道，存储密度都一样了，采用LBA寻址
1、CHS寻址 CHS寻址方式的容量由CHS三个参数决定：(柱面,磁头,扇区)
早期磁盘的每个磁道的扇区数一样多 ，整体磁盘大小也很小。所以在设计时用了24位地址来确定一个扇区：10&#43;8&#43;6
  柱面数最大为1024(用 10 个二进制位存储)。从0开始编号（一个盘面最多能划1024个磁道）
  磁头数最大为256 (用 8 个二进制位存储)。从0开始编号，(最多有256个盘面)
  一个盘面中的扇区数最大数 64(用 6个二进制位存储)
   最大寻址空间：1024*256*64*512byte=8414461440 byte = 8G&#43;
 2、LBA寻址 现代机械磁盘容量变大，主要有如下几个改变：
 磁盘面的磁颗粒更高密&#43;磁头更稳定更细(影响C柱面数) 磁盘面的磁颗粒均匀分布（影响S扇区数） 磁盘增加磁盘盘面（影响H盘面数）  同时采用 LBA逻辑块地址寻址，线性地址，给每个扇区一个编号(0-最后一个扇区号)
LBA将CHS这种三维寻址方式转变为一维的线性寻址，它把硬盘所有的物理扇区(柱面号/盘面号/扇区号) 编号通过一定的规则转变为一维线性的编号，系统效率得到大大提高，避免了 烦琐的(磁头/柱面/扇区)的寻址方式。在访问硬盘时，由硬盘控制器再这种逻辑地址转换为实际硬盘的物理扇区地址
​
​
磁盘分区 1、什么是磁盘分区 磁盘分区就是把一整块磁盘切割为几个部分，相当于 win的 C、E、D盘，Linux的/dev/sda1、/dev/sda2&hellip; 可以把磁盘看做一块原木，分区就是在原木上做一个桌子、椅子" />
<meta property="og:type" content="article" />
<meta property="og:url" content="/2021/01/23/%E7%A3%81%E7%9B%98%E5%92%8C%E5%88%86%E5%8C%BA/" />
<meta property="article:published_time" content="2021-01-23T00:00:00+00:00" />
<meta property="article:modified_time" content="2021-01-23T00:00:00+00:00" />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="磁盘和分区"/>
<meta name="twitter:description" content="​
磁盘物理结构   盘面：一个机械磁盘有好几个盘面组成，中间有转轴
  磁头：盘面正反两面都可以使用，每个盘面都有一个磁头，用来读写这个盘面的数据
  磁道：盘面被物理划分为多个磁道
  扇区：每个磁道会被划分为多个固定512byte大小的扇区（现在也有4k扇区），扇区是磁盘数据存储的最小单位。整个磁盘0盘面0磁道第一个1扇区最重要，记录了整个磁盘的分区信息和操作系统启动程序，计算机启动之后首先加载第一个扇区的信息到内存
  柱面：每个盘面的同一个磁道组成柱面，磁盘的读写顺序就是按照柱面来的，写入时按顺序先写满一个柱面（一个盘面的磁道数据写满后再激活下一个盘面的磁头）然后再移动磁头臂写另外一个柱面，读数据也是按照这个顺序读
  磁盘在出厂前需要进行低级格式化：就是给磁盘划分磁道、扇区。这些属于硬件层面，OS无法控制
​
​
磁盘寻址方式 早期所有磁道的扇区个数一样，采用CHS方式寻址，这种划分方式外磁道颗粒稀疏，存储密度小，造成空间浪费
现在的磁盘外磁道的扇区个数大于内道，存储密度都一样了，采用LBA寻址
1、CHS寻址 CHS寻址方式的容量由CHS三个参数决定：(柱面,磁头,扇区)
早期磁盘的每个磁道的扇区数一样多 ，整体磁盘大小也很小。所以在设计时用了24位地址来确定一个扇区：10&#43;8&#43;6
  柱面数最大为1024(用 10 个二进制位存储)。从0开始编号（一个盘面最多能划1024个磁道）
  磁头数最大为256 (用 8 个二进制位存储)。从0开始编号，(最多有256个盘面)
  一个盘面中的扇区数最大数 64(用 6个二进制位存储)
   最大寻址空间：1024*256*64*512byte=8414461440 byte = 8G&#43;
 2、LBA寻址 现代机械磁盘容量变大，主要有如下几个改变：
 磁盘面的磁颗粒更高密&#43;磁头更稳定更细(影响C柱面数) 磁盘面的磁颗粒均匀分布（影响S扇区数） 磁盘增加磁盘盘面（影响H盘面数）  同时采用 LBA逻辑块地址寻址，线性地址，给每个扇区一个编号(0-最后一个扇区号)
LBA将CHS这种三维寻址方式转变为一维的线性寻址，它把硬盘所有的物理扇区(柱面号/盘面号/扇区号) 编号通过一定的规则转变为一维线性的编号，系统效率得到大大提高，避免了 烦琐的(磁头/柱面/扇区)的寻址方式。在访问硬盘时，由硬盘控制器再这种逻辑地址转换为实际硬盘的物理扇区地址
​
​
磁盘分区 1、什么是磁盘分区 磁盘分区就是把一整块磁盘切割为几个部分，相当于 win的 C、E、D盘，Linux的/dev/sda1、/dev/sda2&hellip; 可以把磁盘看做一块原木，分区就是在原木上做一个桌子、椅子"/>
<meta name="application-name" content="lyer&#39;s blog">
<meta name="apple-mobile-web-app-title" content="lyer&#39;s blog"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
        <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="manifest" href="/site.webmanifest"><link rel="canonical" href="/2021/01/23/%E7%A3%81%E7%9B%98%E5%92%8C%E5%88%86%E5%8C%BA/" /><link rel="prev" href="/2021/01/14/ssl-tsl-https%E5%92%8Cca%E8%AF%81%E4%B9%A6/" /><link rel="next" href="/2021/01/28/%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F/" /><link rel="stylesheet" href="/lib/normalize/normalize.min.css"><link rel="stylesheet" href="/css/style.min.css"><link rel="stylesheet" href="/lib/fontawesome-free/all.min.css"><link rel="stylesheet" href="/lib/animate/animate.min.css"><script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "磁盘和分区",
        "inLanguage": "zh-CN",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "\/2021\/01\/23\/%E7%A3%81%E7%9B%98%E5%92%8C%E5%88%86%E5%8C%BA\/"
        },"genre": "posts","keywords": "Linux, OS","wordcount":  168 ,
        "url": "\/2021\/01\/23\/%E7%A3%81%E7%9B%98%E5%92%8C%E5%88%86%E5%8C%BA\/","datePublished": "2021-01-23T00:00:00+00:00","dateModified": "2021-01-23T00:00:00+00:00","publisher": {
            "@type": "Organization",
            "name": "lyer"},"author": {
                "@type": "Person",
                "name": "lyer"
            },"description": ""
    }
    </script></head>
    <body header-desktop="" header-mobile=""><script type="text/javascript">(window.localStorage && localStorage.getItem('theme') ? localStorage.getItem('theme') === 'dark' : ('' === 'auto' ? window.matchMedia('(prefers-color-scheme: dark)').matches : '' === 'dark')) && document.body.setAttribute('theme', 'dark');</script>

        <div id="mask"></div><div class="wrapper"><header class="desktop" id="header-desktop">
    <div class="header-wrapper">
        <div class="header-title">
            <a href="/" title="lyer&#39;s blog">lyer&#39;s blog</a>
        </div>
        <div class="menu">
            <div class="menu-inner"><a class="menu-item" href="/posts/"> archive </a><a class="menu-item" href="/tags/"> tag </a><a class="menu-item" href="/categories/"> category </a><a class="menu-item" href="/book"> book </a><a class="menu-item" href="/about"> about </a><a class="menu-item" href="/study"> study </a><span class="menu-item delimiter"></span><a href="javascript:void(0);" class="menu-item theme-switch" title="切换主题">
                    <i class="fas fa-adjust fa-fw"></i>
                </a>
            </div>
        </div>
    </div>
</header><header class="mobile" id="header-mobile">
    <div class="header-container">
        <div class="header-wrapper">
            <div class="header-title">
                <a href="/" title="lyer&#39;s blog">lyer&#39;s blog</a>
            </div>
            <div class="menu-toggle" id="menu-toggle-mobile">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="menu" id="menu-mobile"><a class="menu-item" href="/posts/" title="">archive</a><a class="menu-item" href="/tags/" title="">tag</a><a class="menu-item" href="/categories/" title="">category</a><a class="menu-item" href="/book" title="">book</a><a class="menu-item" href="/about" title="">about</a><a class="menu-item" href="/study" title="">study</a><a href="javascript:void(0);" class="menu-item theme-switch" title="切换主题">
                <i class="fas fa-adjust fa-fw"></i>
            </a></div>
    </div>
</header>
<div class="search-dropdown desktop">
    <div id="search-dropdown-desktop"></div>
</div>
<div class="search-dropdown mobile">
    <div id="search-dropdown-mobile"></div>
</div>
<main class="main">
                <div class="container"><div class="toc" id="toc-auto">
            <h2 class="toc-title">目录</h2>
            <div class="toc-content" id="toc-content-auto"></div>
        </div><article class="page single"><h1 class="single-title animated flipInX">磁盘和分区</h1><div class="post-meta">
            <div class="post-meta-line"><span class="post-author"><a href="https://icepan.cloud" title="Author" target="_blank" rel="noopener noreffer author" class="author"><i class="fas fa-user-circle fa-fw"></i>lyer</a></span>&nbsp;<span class="post-category">收录于 <a href="/categories/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/"><i class="far fa-folder fa-fw"></i>操作系统</a></span></div>
            <div class="post-meta-line"><i class="far fa-calendar-alt fa-fw"></i>&nbsp;<time datetime="2021-01-23">2021-01-23</time>&nbsp;<i class="fas fa-pencil-alt fa-fw"></i>&nbsp;约 168 字&nbsp;
                <i class="far fa-clock fa-fw"></i>&nbsp;预计阅读 1 分钟&nbsp;</div>
        </div><div class="details toc" id="toc-static"  kept="">
                <div class="details-summary toc-title">
                    <span>目录</span>
                    <span><i class="details-icon fas fa-angle-right"></i></span>
                </div>
                <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li><a href="#磁盘物理结构">磁盘物理结构</a></li>
    <li><a href="#磁盘寻址方式">磁盘寻址方式</a>
      <ul>
        <li><a href="#1chs寻址">1、CHS寻址</a></li>
        <li><a href="#2lba寻址">2、LBA寻址</a></li>
      </ul>
    </li>
    <li><a href="#磁盘分区">磁盘分区</a>
      <ul>
        <li><a href="#1什么是磁盘分区">1、什么是磁盘分区</a></li>
        <li><a href="#2mbr分区表">2、MBR分区表</a></li>
        <li><a href="#3gpt分区表">3、GPT分区表</a></li>
      </ul>
    </li>
    <li><a href="#bios和uefi">BIOS和UEFI</a>
      <ul>
        <li><a href="#1bios">1、BIOS</a></li>
        <li><a href="#2uefi">2、UEFI</a></li>
      </ul>
    </li>
    <li><a href="#文件系统">文件系统</a>
      <ul>
        <li><a href="#1块和扇区">1、块和扇区</a></li>
        <li><a href="#2vfs虚拟文件系统">2、VFS虚拟文件系统</a></li>
      </ul>
    </li>
    <li><a href="#参考博客和相关优质博客文章">参考博客和相关优质博客文章</a></li>
  </ul>
</nav></div>
            </div><div class="content" id="content"><p>​</p>
<h2 id="磁盘物理结构">磁盘物理结构</h2>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="https://raw.githubusercontent.com/biningo/cdn/master/img/2-1Q01215492WL.jpg"
        data-srcset="https://raw.githubusercontent.com/biningo/cdn/master/img/2-1Q01215492WL.jpg, https://raw.githubusercontent.com/biningo/cdn/master/img/2-1Q01215492WL.jpg 1.5x, https://raw.githubusercontent.com/biningo/cdn/master/img/2-1Q01215492WL.jpg 2x"
        data-sizes="auto"
        alt="https://raw.githubusercontent.com/biningo/cdn/master/img/2-1Q01215492WL.jpg"
        title="img" /></p>
<ul>
<li>
<p><strong>盘面</strong>：一个机械磁盘有好几个盘面组成，中间有转轴</p>
</li>
<li>
<p><strong>磁头</strong>：盘面正反两面都可以使用，每个盘面都有一个磁头，用来读写这个盘面的数据</p>
</li>
<li>
<p><strong>磁道</strong>：盘面被物理划分为多个磁道</p>
</li>
<li>
<p><strong>扇区</strong>：每个磁道会被划分为多个固定<code>512byte</code>大小的扇区（现在也有<code>4k</code>扇区），扇区是磁盘数据存储的最小单位。<strong>整个磁盘<code>0盘面0磁道第一个1扇区</code>最重要，记录了整个磁盘的分区信息和操作系统启动程序，计算机启动之后首先加载第一个扇区的信息到内存</strong></p>
</li>
<li>
<p><strong>柱面</strong>：每个盘面的同一个磁道组成柱面，磁盘的读写顺序就是按照柱面来的，写入时按顺序先写满一个柱面（一个盘面的磁道数据写满后再激活下一个盘面的磁头）然后再移动磁头臂写另外一个柱面，读数据也是按照这个顺序读</p>
</li>
</ul>
<p>磁盘在出厂前需要进行<strong>低级格式化</strong>：就是给磁盘划分磁道、扇区。这些属于硬件层面，OS无法控制</p>
<p>​</p>
<p>​</p>
<h2 id="磁盘寻址方式">磁盘寻址方式</h2>
<p>早期所有磁道的扇区个数一样，采用<code>CHS</code>方式寻址，这种划分方式外磁道颗粒稀疏，存储密度小，造成空间浪费</p>
<p>现在的磁盘外磁道的扇区个数大于内道，存储密度都一样了，采用<code>LBA</code>寻址</p>
<h3 id="1chs寻址">1、CHS寻址</h3>
<p>CHS寻址方式的容量由CHS三个参数决定：<code>(柱面,磁头,扇区)</code></p>
<p>早期磁盘的每个磁道的扇区数一样多 ，整体磁盘大小也很小。所以在设计时用了<code>24</code>位地址来确定一个扇区：<code>10+8+6</code></p>
<ul>
<li>
<p>柱面数最大为<code>1024</code>(用 10 个二进制位存储)。从0开始编号（一个盘面最多能划1024个磁道）</p>
</li>
<li>
<p>磁头数最大为<code>256</code> (用 8 个二进制位存储)。从0开始编号，(最多有256个盘面)</p>
</li>
<li>
<p>一个盘面中的扇区数最大数 <code>64</code>(用 6个二进制位存储)</p>
</li>
</ul>
<blockquote>
<p><strong>最大寻址空间：<code>1024*256*64*512byte=8414461440 byte = 8G+</code></strong></p>
</blockquote>
<h3 id="2lba寻址">2、LBA寻址</h3>
<p>现代机械磁盘容量变大，主要有如下几个改变：</p>
<ul>
<li>磁盘面的磁颗粒更高密+磁头更稳定更细(影响C柱面数)</li>
<li>磁盘面的磁颗粒均匀分布（影响S扇区数）</li>
<li>磁盘增加磁盘盘面（影响H盘面数）</li>
</ul>
<p>同时采用 <code>LBA</code>逻辑块地址寻址，线性地址，给每个扇区一个编号(0-最后一个扇区号)</p>
<p><code>LBA</code>将<code>CHS</code>这种三维寻址方式转变为一维的线性寻址，它把硬盘所有的物理扇区<code>(柱面号/盘面号/扇区号)</code> 编号通过一定的规则转变为<strong>一维线性的编号</strong>，系统效率得到大大提高，避免了 烦琐的<code>(磁头/柱面/扇区)</code>的寻址方式。在访问硬盘时，由<strong>硬盘控制器</strong>再这种逻辑地址转换为实际硬盘的物理扇区地址</p>
<p>​</p>
<p>​</p>
<h2 id="磁盘分区">磁盘分区</h2>
<h3 id="1什么是磁盘分区">1、什么是磁盘分区</h3>
<p>磁盘分区就是把一整块磁盘切割为几个部分，相当于 win的 C、E、D盘，Linux的/dev/sda1、/dev/sda2&hellip;  可以把磁盘看做一块原木，分区就是在原木上做一个桌子、椅子</p>
<p><strong>进行磁盘分区主要有如下几个原因：</strong></p>
<ul>
<li><strong>方便数据管理</strong></li>
<li><strong>保证数据安全</strong>，不同分区之间数据互不干扰</li>
<li><strong>加快数据查找</strong>：因为文件系统会将磁盘分成一个个的数据块，单个文件数据可能是存放在不连续的块中，如果分区太大，某个文件数据块分散的存在开头和结尾那么磁头臂的移动就会非常频繁造成读取效率低下</li>
</ul>
<h3 id="2mbr分区表">2、MBR分区表</h3>
<p><strong><code>Master Boot Record 主要开机记录区</code>：MBR</strong></p>
<p>主要用于早期磁盘容量还很小的时代和<code>32</code>位机器时代</p>
<p>由于单个扇区大小只有 <code>512b</code>，所以第一个扇区主要保存如下几个内容：</p>
<ul>
<li>操作系统的<code>bootloader</code>程序（机器码程序）：<code>446byte</code></li>
<li>分区表：<code>64byte</code>，每个分区表项大小为<code>16byte</code>，有<code>4</code>个分区表项</li>
<li>结束标识<code>55 AA</code>：<code>2byte</code>  如果<strong>BIOS</strong>检测到以此标识结尾，则表明此磁盘是启动磁盘，如果检测不到，则将跳过此设备，转向下一个设备</li>
</ul>
<p>为了设置更多的分区，于是就有了 <strong>主分区和扩展分区</strong> 的概念</p>
<ul>
<li>扩展分区最多<code>1</code>个（历史前人规定，没有原因）觉得想要更多的分区，就必须将其中一个分区表项设置为扩展分区</li>
<li>在这个扩展分区指定的磁盘空间中的扇区中再设置分区表，借此来划分跟多的分区，这些分区就叫 <strong>逻辑分区</strong></li>
</ul>
<p>关于主分区和扩展分区网上找了一张自认为比较好的图：</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="https://raw.githubusercontent.com/biningo/cdn/master/img/2084106-20200705233500139-1171448891.png"
        data-srcset="https://raw.githubusercontent.com/biningo/cdn/master/img/2084106-20200705233500139-1171448891.png, https://raw.githubusercontent.com/biningo/cdn/master/img/2084106-20200705233500139-1171448891.png 1.5x, https://raw.githubusercontent.com/biningo/cdn/master/img/2084106-20200705233500139-1171448891.png 2x"
        data-sizes="auto"
        alt="https://raw.githubusercontent.com/biningo/cdn/master/img/2084106-20200705233500139-1171448891.png"
        title="MBR拓展分区" /></p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="https://raw.githubusercontent.com/biningo/cdn/master/img/e8a58d15c658cfce9a05c7883310022e.png"
        data-srcset="https://raw.githubusercontent.com/biningo/cdn/master/img/e8a58d15c658cfce9a05c7883310022e.png, https://raw.githubusercontent.com/biningo/cdn/master/img/e8a58d15c658cfce9a05c7883310022e.png 1.5x, https://raw.githubusercontent.com/biningo/cdn/master/img/e8a58d15c658cfce9a05c7883310022e.png 2x"
        data-sizes="auto"
        alt="https://raw.githubusercontent.com/biningo/cdn/master/img/e8a58d15c658cfce9a05c7883310022e.png"
        title="img" /></p>
<p>操作系统启动程序<code>bootloader</code>可以直接安装到<code>MBR</code>中，也可以安装到某个分区中的<strong>引导扇区</strong> ，通过引导扇区可以实现 <strong>多系统</strong>，比如将选择启动系统的程序安装到<code>MBR</code>中，然后将操作系统各自的<code>bootloader</code>程序安装到自己的分区中的引导扇区中</p>
<p>Window安装时默认会自动将MBR和windows所在分区的引导扇区都装上引导程序，而不会提供任何选项给用户选择，因此如果之前装过其他操作系统，然后再另外装一个windows时，会把公用的MBR覆盖掉，如此，原来的操作系统就无法启动了。</p>
<p>如果先装windows，然后装linux，linux 会覆盖MBR，然后让用户选择是否将windows等其他操作系统的启动项添加进来，如果你选择了添加进来，那么你在开机时就会有两个选项让用户进行选择了。</p>
<p><strong>MBR分区主要有如下几个缺点：</strong></p>
<ul>
<li>第一个扇区毁坏，整个磁盘不可用</li>
<li>MBR内操作系统的启动程序<code>bootloader</code>大小有限，无法做更多的操作</li>
<li>分区表大小有限，主分区数量有限</li>
<li>磁盘大小有限，磁盘最大有 <code>2T</code>（这个限制需要是由于MBR分区表项字段限制的）原因可以参考如下文章https://www.cnblogs.com/harrymore/p/13782261.html，也就是说如果有一个<code>4T、3T</code>或则更大的磁盘额外的空间就无法被识别，分区大小最大也只能有<code>2T</code> 也就是只划分一个区的情况</li>
</ul>
<p><strong>MBR分区表项结构：</strong>（活动分区指操作系统安装的分区）</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="https://raw.githubusercontent.com/biningo/cdn/master/img/741682-20201008184307747-1604693136.gif"
        data-srcset="https://raw.githubusercontent.com/biningo/cdn/master/img/741682-20201008184307747-1604693136.gif, https://raw.githubusercontent.com/biningo/cdn/master/img/741682-20201008184307747-1604693136.gif 1.5x, https://raw.githubusercontent.com/biningo/cdn/master/img/741682-20201008184307747-1604693136.gif 2x"
        data-sizes="auto"
        alt="https://raw.githubusercontent.com/biningo/cdn/master/img/741682-20201008184307747-1604693136.gif"
        title="img" /></p>
<h3 id="3gpt分区表">3、GPT分区表</h3>
<p><strong><code>GUID Partition Table 全局唯一标识码分区表</code>：GPT ，又称<code>GUID</code>分区表</strong></p>
<p>由于现代磁盘容量不断扩大，现在扇区大小已经是<code>4k</code>，早期的MBR分区的各种缺点已经不适应现代磁盘了，所以就有GPT分区方式，采用 <code>LBA</code>线性寻址方式，从0开始给每个扇区一个编号</p>
<p><code>LBA0</code>仍然为<code>MBR</code>，但是这个扇区是被保护的，没有引导代码，仅仅被标识为<strong>未知分区</strong>，并且加上<code>GPT</code>类型分区的标识。当支持<code>GPT</code>的计算机引导启动序比<code>UEFI</code>检测到这个第一个扇区就会忽略此扇区，然后跳到<code>LBA1</code>读取<code>GPT</code>分区表信息</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="https://raw.githubusercontent.com/biningo/cdn/master/img/2197081350-57df35aff3e09b54_articlex.png"
        data-srcset="https://raw.githubusercontent.com/biningo/cdn/master/img/2197081350-57df35aff3e09b54_articlex.png, https://raw.githubusercontent.com/biningo/cdn/master/img/2197081350-57df35aff3e09b54_articlex.png 1.5x, https://raw.githubusercontent.com/biningo/cdn/master/img/2197081350-57df35aff3e09b54_articlex.png 2x"
        data-sizes="auto"
        alt="https://raw.githubusercontent.com/biningo/cdn/master/img/2197081350-57df35aff3e09b54_articlex.png"
        title="gpt" /></p>
<p>如果不能识别<code>GPT</code>，则分下面两种情况讨论：</p>
<ul>
<li>采用兼容模式，则继续按照传统的<code>BIOS</code>方式读取第一个<code>MBR</code>扇区也就是<code>LBA0</code>扇区，然后通过<code>bootloador</code>启动操作系统</li>
<li>直接报错表示无法识别，保护磁盘数据，防止被老的系统格式化磁盘数据</li>
</ul>
<p><code>LBA2-LBA33</code>每个<code>LAB</code>扇区都可以记录<code>4</code>个分区表项，每个 <code>LBA</code>扇区大小为<code>512b</code>，所以每个表项大小为<code>128b</code>，一共可以记录<code>4*32=128</code>条表项目，也就是说最多可以设置128个分区，<code>LBA</code>采用<code>64bits</code>来记录扇区号，所以一个分区的容量最大可以达到<code>2^64*512b=233TB</code>，所以整块磁盘大小可以是 <code>128*233TB=1024PB</code>  ，GPT没有所谓的主分区和逻辑分区，全部都是主分区</p>
<blockquote>
<p><strong>分区表扇区只是记录分区信息，其他扇区才是分区具体存放数据的扇区</strong></p>
</blockquote>
<p>​</p>
<p>​</p>
<h2 id="bios和uefi">BIOS和UEFI</h2>
<h3 id="1bios">1、BIOS</h3>
<p><strong><code>Basic Input/Output System</code>基本输入输出系统：BIOS</strong></p>
<p>BIOS启动的时候按照固件中设置的设备启动顺序启动，挨个查看存储设备的前<code>512</code>字节是不是以<code>0x55 0xAA</code>结尾，如果不是，那就跳过找下一个设备；如果是的话，则表示这个磁盘可以启动，加载这<code>512</code>字节里的代码，然后执行里面的 <code>bootloader</code>程序，<code>bootloader</code>程序是在安装系统的时候写进去的，比如安装<code>Windows</code>，这里面就变成了<code>Windows</code>的启动代码；安装了<code>Linux</code>，这里面就会变成<code>Grub</code>的启动代码</p>
<p>比如用U盘安装Linux，那么Linux安装程序就会在安装系统时在第一个扇区写入<code>bootloader</code>程序，同时将系统安装到某个分区中（存放要启动操作系统的分区称为活动分区，一张磁盘只能有一个活动分区，比如装了双系统win和linux，要启动linux则linux系统安装的分区称为活动分区），以便<code>bootloader</code>查找并加载系统到内存进行执行</p>
<p>所以 BIOS启动流程主要是：</p>
<ul>
<li><code>ROM</code>中的<code>BIOS</code>程序被加载到内存执行</li>
<li><code>BIOS</code>开机自检</li>
<li><code>BIOS</code>读取<code>CMOS</code>存储器固件中设置的启动设备信息（这里面的信息可以人为的通过BIOS程序修改以调整启动顺序），加载启动设备的第一个<code>MBR</code>扇区到内存</li>
<li>执行<code>MBR</code>中的<code>bootloader</code>程序（由于第一块分区中的<code>bootloader</code>存储空间有限，则可以继续跳转到其他分区中存储的<code>bootloader</code>进行执行，Linux就是采用这种方式&mdash;-链式启动）</li>
</ul>
<h3 id="2uefi">2、UEFI</h3>
<p><strong><code>Unified Extensible Firmware Interface</code>统一的可扩展固件接口：UEFI</strong></p>
<p>目的是代替<code>BIOS</code>，UEFI程序只能识别 <code>FAT32</code>类型的文件系统，UEFI规定UEFI系统分区<code>EFI system partition (ESP)</code>系统启动分区必须采用<code>FAT32</code>文件系统，<code>ESP</code>分区通常为<code>128M</code>，主要用来存放引导操作系统启动的<code>.efi</code>启动文件</p>
<p>所以UEFI启动流程如下：</p>
<ul>
<li>开机后，固化在<code>ROM</code>里的<code>UEFI BIOS</code>就会被加载到内存运行</li>
<li><code>UEFI BIOS</code>能够通过程序识别<code>GPT</code>分区表和<code>FAT32</code>文件系统</li>
<li><code>UEFI BIOS</code>识别出<code>ESP</code>分区（ESP在GPT分区表中有一个GUID），读取<code>FAT32</code>文件系统中的各种启动文件启动操作系统内核，比如<code>.efi</code></li>
<li><code>EFI</code>运行之后控制权就全部交给<code>EFI</code>系统了</li>
</ul>
<blockquote>
<p><strong>BIOS+MBR已经趋于淘汰，UEFI+GPT是大势所趋</strong></p>
</blockquote>
<p>​</p>
<p>​</p>
<h2 id="文件系统">文件系统</h2>
<p>对磁盘进行分区之后，还需要对分区进行格式化，也就是在分区上面安装文件系统，这样操作系统才可以操作磁盘，<strong>所以说文件系统是对磁盘的抽象，方便用户和操作系统操作磁盘</strong></p>
<p>文件系统安装完毕之后，就可以将操作系统内核保存在磁盘上了，然后就可以等待启动程序来识别文件系统找到操作系统内核代码保存的位置然后加载到内存进行执行了</p>
<h3 id="1块和扇区">1、块和扇区</h3>
<ul>
<li><strong>扇区</strong>是磁盘读取的基本单位，**块（block）**是文件系统读取数据的基本单位：因为一个扇区太小了，如果一个扇区一个扇区读写，会造成IO次数太多，效率低下，所以文件系统将多个扇区组成一个block，一个block大小通常为<code>4k</code>，如果一个文件不足一个block大小，也必须要占一个block，加载数据到内存时会加载数据所在的整个block到内存</li>
<li>操作系统将内存大小抽象为页，将磁盘抽象为block，和内存页一样，block的大小不能设置太大或太小</li>
</ul>
<h3 id="2vfs虚拟文件系统">2、VFS虚拟文件系统</h3>
<p>虚拟文件系统就是给文件系统的实现提供一个接口，好处有下面几个：</p>
<ul>
<li><strong>为用户进程提供一组操作文件/目录/其他对象的统一方法，方便操作</strong></li>
<li><strong>为下层文件系统的具体实现提供统一的接口，让操作系统能适配多个文件系统</strong></li>
</ul>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="https://raw.githubusercontent.com/biningo/cdn/master/img/KVrP0Yk.png"
        data-srcset="https://raw.githubusercontent.com/biningo/cdn/master/img/KVrP0Yk.png, https://raw.githubusercontent.com/biningo/cdn/master/img/KVrP0Yk.png 1.5x, https://raw.githubusercontent.com/biningo/cdn/master/img/KVrP0Yk.png 2x"
        data-sizes="auto"
        alt="https://raw.githubusercontent.com/biningo/cdn/master/img/KVrP0Yk.png"
        title="image-20181020173556821" /></p>
<p>​</p>
<p>​</p>
<h2 id="参考博客和相关优质博客文章">参考博客和相关优质博客文章</h2>
<p><a href="https://cloud.tencent.com/developer/article/1383160">https://cloud.tencent.com/developer/article/1383160</a></p>
<p><a href="https://www.cnblogs.com/cxuanBlog/p/13156493.html">https://www.cnblogs.com/cxuanBlog/p/13156493.html</a></p>
<p><a href="https://segmentfault.com/a/1190000020850901">https://segmentfault.com/a/1190000020850901</a></p>
<p><a href="https://www.i3geek.com/archives/1275">https://www.i3geek.com/archives/1275</a></p>
<p><a href="https://www.junmajinlong.com/linux/systemd/systemd_bootup/">https://www.junmajinlong.com/linux/systemd/systemd_bootup/</a></p>
<p><a href="https://zhuanlan.zhihu.com/p/26098509">https://zhuanlan.zhihu.com/p/26098509</a></p>
<p><a href="https://zhuanlan.zhihu.com/p/25992179">https://zhuanlan.zhihu.com/p/25992179</a></p>
<p><a href="https://segmentfault.com/a/1190000006872609">https://segmentfault.com/a/1190000006872609</a></p>
<p><a href="https://juejin.cn/post/6844904102258819080#heading-13">https://juejin.cn/post/6844904102258819080#heading-13</a></p>
<p><a href="http://lionoggo.com/2015/12/05/%e4%bb%8eVFS%e7%9c%8b%e6%96%87%e4%bb%b6%e8%af%bb%e5%86%99/#" target="_blank" rel="noopener noreffer">http://lionoggo.com</a></p>
<p><a href="https://juejin.cn/post/6912354117306286087#heading-2">https://juejin.cn/post/6912354117306286087#heading-2</a></p>
<p><a href="https://www.ruanyifeng.com/blog/2011/12/inode.html">https://www.ruanyifeng.com/blog/2011/12/inode.html</a></p>
<p>鸟哥的Linux私房菜</p>
</div><div class="post-footer" id="post-footer">
    <div class="post-info">
        <div class="post-info-line">
            <div class="post-info-mod">
                <span>更新于 2021-01-23</span>
            </div>
            <div class="post-info-license"></div>
        </div>
        <div class="post-info-line">
            <div class="post-info-md"></div>
            <div class="post-info-share">
                <span></span>
            </div>
        </div>
    </div>

    <div class="post-info-more">
        <section class="post-tags"><i class="fas fa-tags fa-fw"></i>&nbsp;<a href="/tags/linux/">linux</a>,&nbsp;<a href="/tags/os/">OS</a></section>
        <section>
            <span><a href="javascript:void(0);" onclick="window.history.back();">返回</a></span>&nbsp;|&nbsp;<span><a href="/">主页</a></span>
        </section>
    </div>

    <div class="post-nav"><a href="/2021/01/14/ssl-tsl-https%E5%92%8Cca%E8%AF%81%E4%B9%A6/" class="prev" rel="prev" title="SSL-TSL-HTTPS和CA证书"><i class="fas fa-angle-left fa-fw"></i>SSL-TSL-HTTPS和CA证书</a>
            <a href="/2021/01/28/%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F/" class="next" rel="next" title="文件系统">文件系统<i class="fas fa-angle-right fa-fw"></i></a></div>
</div>
<div id="comments"><div id="gitalk" class="comment"></div><noscript>
                Please enable JavaScript to view the comments powered by <a href="https://github.com/gitalk/gitalk"></a>Gitalk</a>.
            </noscript></div></article></div>
            </main><footer class="footer">
        <div class="footer-container"><div class="footer-line">由 <a href="https://gohugo.io/" target="_blank" rel="noopener noreffer" title="Hugo 0.80.0">Hugo</a> 强力驱动 | 主题 - <a href="https://github.com/dillonzq/LoveIt" target="_blank" rel="noopener noreffer" title="LoveIt 0.2.10"><i class="far fa-kiss-wink-heart fa-fw"></i> LoveIt</a>
                </div><div class="footer-line"><i class="far fa-copyright fa-fw"></i><span itemprop="copyrightYear">2021</span><span class="author" itemprop="copyrightHolder">&nbsp;<a href="https://icepan.cloud" target="_blank">lyer</a></span>&nbsp;|&nbsp;<span class="license"><a rel="license external nofollow noopener noreffer" href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank">CC BY-NC 4.0</a></span></div>
        </div>
    </footer></div>

        <div id="fixed-buttons"><a href="#" id="back-to-top" class="fixed-button" title="回到顶部">
                <i class="fas fa-arrow-up fa-fw"></i>
            </a><a href="#" id="view-comments" class="fixed-button" title="查看评论">
                <i class="fas fa-comment fa-fw"></i>
            </a>
        </div><link rel="stylesheet" href="/lib/gitalk/gitalk.min.css"><script type="text/javascript" src="/lib/gitalk/gitalk.min.js"></script><script type="text/javascript" src="/lib/smooth-scroll/smooth-scroll.min.js"></script><script type="text/javascript" src="/lib/lazysizes/lazysizes.min.js"></script><script type="text/javascript" src="/lib/clipboard/clipboard.min.js"></script><script type="text/javascript">window.config={"code":{"copyTitle":"复制到剪贴板","maxShownLines":10},"comment":{"gitalk":{"admin":["biningo"],"clientID":"c8f473d59880800a7453","clientSecret":"7aa3dd0bcf966dee0a057e06eaf205caeb86b8e0","id":"2021-01-23T00:00:00Z","owner":"biningo","repo":"hugo-blog-gittalk","title":"磁盘和分区"}}};</script><script type="text/javascript" src="/js/theme.min.js"></script></body>
</html>
